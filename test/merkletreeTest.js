const chai = require('chai');
const expect = chai.expect;
const iden3 = require('../index');

describe('checkProof()', function() {
  it('checkProof 1', function() {
    let rootHex = '0x7d7c5e8f4b3bf434f3d9d223359c4415e2764dd38de2e025fbf986e976a7ed3d';
    let mpHex = '0x0000000000000000000000000000000000000000000000000000000000000002d45aada6eec346222eaa6b5d3a9260e08c9b62fcf63c72bc05df284de07e6a52';
    let hiHex = '0x786677808ba77bdd9090a969f1ef2cbd1ac5aecd9e654f340500159219106878';
    let htHex = '0x786677808ba77bdd9090a969f1ef2cbd1ac5aecd9e654f340500159219106878';
    let verified = iden3.merkletree.checkProof(rootHex, mpHex, hiHex, htHex, 140);
    expect(verified).to.be.equal(true);
  });
});
describe('checkProof of Empty Leaf', function() {
  it('checkProof', function() {
    let rootHex = '0x8f021d00c39dcd768974ddfe0d21f5d13f7215bea28db1f1cb29842b111332e7';
    let mpHex = '0x0000000000000000000000000000000000000000000000000000000000000004bf8e980d2ed328ae97f65c30c25520aeb53ff837579e392ea1464934c7c1feb9';
    let hiHex = '0xa69792a4cff51f40b7a1f7ae596c6ded4aba241646a47538898f17f2a8dff647';
    let htHex = '0x0000000000000000000000000000000000000000000000000000000000000000';
    let verified = iden3.merkletree.checkProof(rootHex, mpHex, hiHex, htHex, 140);
    expect(verified).to.be.equal(true);
  });
});

describe('proofOfClaim()', function() {
  it('proofOfClaim', function() {
    let proofOfClaimStr = `
      {
        "ClaimProof": {
          "Leaf": "0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074cfee7c08a98f4b565d124c7e4e28acc52e1bc780e3887db00000004700000000617364666161616173646661",
          "Hi": "0x4b4e5e67e2ec4c0e60f2d04d792ea8cb9ff8f8c60796880fe5ad295c0d7628ec",
          "Proof": "0x000000000000000000000000000000000000000000000000000000000000001f8758729974906fcb396a86cb021425b492efe272aa9a47a3e91bce0d1e2882907fe529fae33154b77a6ab00ae6bcdfc0466cc6fcadf85178db665ffba0dc6175128190546361ab9692b7f6c45e83686d10c30e0ac7d09e647af1a33ebb443463fa25bae90ed62f50f14451880a00020467e8275a1009d59ef1d3cadae37857dd9e697ff79499ece5e1c39f635ca4d2ecc7449e7e0d049bf28dad0e2685c68852",
          "Root": "0x0a9da41723b9fbf274ac403255136b098a9a1bcc725967eddc6c56fd7aa67a20"
        },
        "SetRootClaimProof": {
          "Leaf": "0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c49694030749b9a76a0132a0814192c05c9321efc30c7286f6187f18fc60000005400000013bc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f0a9da41723b9fbf274ac403255136b098a9a1bcc725967eddc6c56fd7aa67a20",
          "Hi": "0x3c10f157cef84437beffa68d54a6ed5fff18fa650999cc124e43a42d515e1bea",
          "Proof": "0x000000000000000000000000000000000000000000000000000000000000001f690aebf4ef5a5be550ad82811167b1c9b4a42e49a9f2893023944efaf1f5833c6a658b3b4abe14eadeb5f94ea27304d41daa2a412e3198849b5f4670fe79dccf2378883a38405ff857c05b48bb92bea86b79ad75c43b8acc774412416806c1e216e1f1dd55ae2204e723049986e9b31c944786b11c4cf7781455beefc03b4cb02d9579046d6eb619da569e53f90c5a0d1b1b08a79c83e31c01e95c4a46f1d02a",
          "Root": "0x934fb7f639ec2a937c46431b45a1db9338b329e908383fc5e61f20db794b63c8"
        },
        "ClaimNonRevocationProof": {
          "Leaf": "0x0000000000000000000000000000000000000000000000000000000000000000",
          "Hi": "0xc9297062f54883081c290ac968a5a132c1ca9add69a8763a9c0da258aa190054",
          "Proof": "0x000000000000000000000000000000000000000000000000000000000000010fc3e3aa7b77a7ece3eb4a176c318540e39d4758b7077bafa39e2982d4745a0d4fd159d917cbd9415eba3f301507bba19b3273c463074b3cf8c347b28c6ccfff59128190546361ab9692b7f6c45e83686d10c30e0ac7d09e647af1a33ebb443463fa25bae90ed62f50f14451880a00020467e8275a1009d59ef1d3cadae37857dd9e697ff79499ece5e1c39f635ca4d2ecc7449e7e0d049bf28dad0e2685c68852",
          "Root": "0x0a9da41723b9fbf274ac403255136b098a9a1bcc725967eddc6c56fd7aa67a20"
        },
        "SetRootClaimNonRevocationProof": {
          "Leaf": "0x0000000000000000000000000000000000000000000000000000000000000000",
          "Hi": "0x4b2a8e9fad0585151766a4f71c1dba32ca821d759fdeb35f8b5cc416abffdfe1",
          "Proof": "0x00000000000000000000000000000000000000000000000000000000000000679841c9eb2875604dc46b9e8dca707bb79c8cb215182ea33d010be0abb0ba8f0533875519d71c690a0782eb7f11764dd556f7e57bebbe949f641702cc13790d39cf8c0a21aa8cd56013c0811c898ee2c9c4115fb759dde98e8a8eb88912de135eeeba710ef8de46a9925f0f5a11669b33fc88a7d3131a95ea02e68bb2d4a2988c32082d04bfb509aea87e447f8fdbddb75ee83cde2a556d38cde972662c4c2828",
          "Root": "0x934fb7f639ec2a937c46431b45a1db9338b329e908383fc5e61f20db794b63c8"
        },
        "Signature": "0xe20c498225ad3fccba12b93f6ac61df6f142bdf4091ccd92060a115c45791caf51f97f284e0e7ce2407a693686b8b2e4f178b1153ef3ed04748331990017564100"
      }
    `;
    let proofOfClaim = JSON.parse(proofOfClaimStr);
    let verified = iden3.merkletree.checkProofOfClaim(proofOfClaim, 140);
    expect(verified).to.be.equal(true);
  });
});
